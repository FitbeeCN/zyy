var assert = require('assert');
var security = require('../index.js');

function suite(str) {
  console.log(str + '===============\n');
}

function test(str, callback) {
  console.log(str + ': ');
  try {
    callback();
    console.log('ok');
    console.log('\n');
  } catch (e) {
    console.log(e);
    console.log('\n');
  }
}

suite('basic');

test('encode-decode-basic', function(){
  
  var a = security.code('abcdaed', 'ENCODE', 'key', 0);
  console.log("a:",a);

  var b = security.code(a, 'DECODE', 'key');
  console.log('b:',b);
  
  assert.deepEqual('abcdaed', b);
});

test('BASE64', function(){
  
  var a = security.base64_encode('abcdaed');
  console.log("a:",a);

  var b = security.base64_decode(a);
  console.log('b:',b);
  
  assert.deepEqual('abcdaed', b);
});

test('time-keyexists', function(){
  var a = security.code('abcd', 'ENCODE', 'key', 10);
  console.log(a);
    
  var start = Math.ceil((new Date).getTime() / 1000);
  while(true) {
    var end = Math.ceil((new Date).getTime() / 1000);
    if (end - start > 11) {
      break;
    }
  }
  
  var b = security.code(a, 'DECODE', 'key');
  console.log(b);
  assert.deepEqual('abcd', b);
});
