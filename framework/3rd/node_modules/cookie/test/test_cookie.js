var http = require('http');
var assert = require('assert');
var cookie = require('../index.js');

function suite(str) {
  console.log(str + '===============\n');
}

function test(str, callback) {
  console.log(str + ': ');
  try {
    callback();
    console.log('ok');
    console.log('\n');
  } catch (e) {
    console.log(e);
    console.log('\n');
  }
}

//////////////////////////////////////////////////
//parse
//////////////////////////////////////////////////

suite('parse');

test('basic', function() {
    assert.deepEqual({ foo: 'bar' }, cookie.parse('foo=bar.j6AYFUGPjUwl55vVuIqqFWyLDH4PUWKbv5iavRhADHU', 'afjiwEnaDjiw'));
});

//////////////////////////////////////////////////
// serialize
//////////////////////////////////////////////////

suite('serialize');

test('basic', function() {
    assert.equal('foo=bar', cookie.serialize('foo', 'bar'));
    assert.equal('foo=bar%20baz', cookie.serialize('foo', 'bar baz'));
});

test('path', function() {
    assert.equal('foo=bar; Path=/', cookie.serialize('foo', 'bar', {
        path: '/'
    }));
});

test('secure', function() {
    assert.equal('foo=bar; Secure', cookie.serialize('foo', 'bar', {
        secure: true
    }));

    assert.equal('foo=bar', cookie.serialize('foo', 'bar', {
        secure: false
    }));
});

test('domain', function() {
    assert.equal('foo=bar; Domain=example.com', cookie.serialize('foo', 'bar', {
        domain: 'example.com'
    }));
});

test('httpOnly', function() {
    assert.equal('foo=bar; HttpOnly', cookie.serialize('foo', 'bar', {
        httpOnly: true
    }));
});

test('maxAge', function() {
    assert.equal('foo=bar; Max-Age=1000', cookie.serialize('foo', 'bar', {
        maxAge: 1000
    }));
});

test('escaping', function() {
    assert.deepEqual('cat=%2B%20', cookie.serialize('cat', '+ '));
});


//////////////////////////////////////////////////
// setCookie/getCookie
//////////////////////////////////////////////////

suite('setCookie/parseCookie start');

          
var util = require('util');
var http = require('http');

http.createServer(function(req, res){

  cookie.parseCookie(req);
  cookie.setCookie(req, res, 'foo', 'bar', {expires:100000, domain:'test.localhost.com', 'httpOnly':true, 'secure':true});
  cookie.setCookie(req, res, 'bar', 'bar', {expires:100000, domain:'test.localhost.com'});
  cookie.setCookie(req, res, 'test', 'bar', {expires:100000, domain:'test.localhost.com'});
  cookie.setCookie(req, res, 'ssss', '.sfwefdng./', {expires:100000, domain:'test.localhost.com'});
  res.end(util.inspect(req, true, true));
}).listen(1337);












